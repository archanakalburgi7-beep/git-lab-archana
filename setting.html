<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - MindTracker AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
   <style>
    :root {
        --primary-gradient: linear-gradient(135deg, #00bcd4, #008c9e);
        --primary-color: #00bcd4;
        --background-light: #f4f7f6;
        --background-card: #ffffff;
        --text-dark: #2c3e50;
        --text-muted: #7f8c8d;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .dark-mode {
        --background-light: #0f172a;
        --background-card: #1e293b;
        --text-dark: #f1f5f9;
        --text-muted: #94a3b8;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        background-color: var(--background-light) !important;
        color: var(--text-dark) !important;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--background-light);
        color: var(--text-dark);
        transition: var(--transition);
        line-height: 1.6;
    }

    .settings-container { 
        max-width: 850px; 
        margin: 40px auto; 
        padding: 0 20px; 
    }

    /* Attractive Card Design */
    .settings-card {
        background-color: var(--background-card);
        border-radius: 20px;
        padding: 30px;
        box-shadow: var(--shadow);
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .settings-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
    }

    .settings-card h5 {
        color: var(--primary-color);
        font-weight: 700;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
    }

    .settings-card h5 i {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 1.3rem;
    }

    /* Setting Items Styling */
    .setting-item {
        display: flex; 
        justify-content: space-between;
        align-items: center; 
        padding: 15px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .dark-mode .setting-item {
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .setting-item:last-child {
        border-bottom: none;
    }

    .setting-item label {
        font-weight: 500;
        font-size: 1rem;
    }

    /* Screen Time Display - Modern Badge */
    #screenTimeDisplay {
        font-family: 'JetBrains Mono', monospace;
        background: var(--primary-gradient);
        padding: 4px 12px;
        border-radius: 50px;
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
        box-shadow: 0 4px 10px rgba(0, 188, 212, 0.3);
    }

    /* Custom Switch & Inputs */
    .form-check-input:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        box-shadow: 0 0 10px rgba(0, 188, 212, 0.4);
    }

    .form-select, .form-control {
        border-radius: 10px;
        border: 1px solid #e2e8f0;
        padding: 8px 12px;
        transition: var(--transition);
    }

    .form-select:focus, .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.15);
    }

    /* Profile Section Enhancements */
    .profile-img {
        width: 90px; height: 90px; 
        border-radius: 24px;
        object-fit: cover; 
        border: 3px solid white;
        box-shadow: var(--shadow);
        transition: var(--transition);
    }

    .dark-mode .profile-img {
        border-color: #334155;
    }

    .profile-img:hover {
        transform: rotate(3deg) scale(1.05);
    }

    /* Buttons Style */
    .btn-primary {
        background: var(--primary-gradient);
        border: none;
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: 600;
        transition: var(--transition);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 188, 212, 0.4);
        opacity: 0.9;
    }

    .btn-outline-secondary {
        border-radius: 10px;
        border: 2px solid #e2e8f0;
        color: var(--text-muted);
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .settings-card {
        animation: fadeIn 0.5s ease backwards;
    }

    .settings-card:nth-child(1) { animation-delay: 0.1s; }
    .settings-card:nth-child(2) { animation-delay: 0.2s; }
    .settings-card:nth-child(3) { animation-delay: 0.3s; }
</style>
</head>
<body>

    <div class="settings-container">
        <a href="dashboard.html" class="btn btn-sm btn-outline-secondary mb-4">
            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
        </a>
        
        <h1 class="mb-4" style="font-family: 'Poppins', sans-serif;">App Settings</h1>

        <div class="settings-card">
            <h5><i class="fas fa-palette me-2"></i> Appearance Settings</h5>
            <div class="setting-item">
                <label class="fw-bold">Color Theme</label>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-light" id="theme-light">Light</button>
                    <button type="button" class="btn btn-sm btn-dark" id="theme-dark">Dark</button>
                </div>
            </div>
            <div class="setting-item">
                <label class="fw-bold">Accent Color</label>
                <input type="color" class="form-control form-control-color" id="accentColor" value="#00bcd4">
            </div>
        </div>

        <div class="settings-card">
            <h5><i class="fas fa-user-circle me-2"></i> Profile and Data</h5>
            <div class="profile-photo-area">
                <img id="profileImage" src="https://via.placeholder.com/80/00bcd4/FFFFFF?text=P" class="profile-img">
                <div>
                    <h6 class="mb-1">Change Profile Photo</h6>
                    <div class="d-flex gap-2 mt-2">
                        <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                        <button class="btn btn-sm btn-outline-primary" onclick="document.getElementById('photoUpload').click()">Gallery</button>
                        <button class="btn btn-sm btn-outline-success" id="openCameraBtn">Camera</button>
                    </div>
                </div>
            </div>
            <div class="setting-item">
                <div>
                    <label class="fw-bold">Screen Time Tracking</label><br>
                    <small class="text-muted">Since Login: <span id="screenTimeDisplay">00:00:00</span></small>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="screenTimeSwitch" checked>
                </div>
            </div>
        </div>

        <div class="settings-card">
            <h5><i class="fas fa-bell me-2"></i> Notifications</h5>
            <div class="setting-item">
                <label class="fw-bold">Notification Tone (Preview)</label>
                <select class="form-select form-select-sm" style="width: 170px;" id="notifToneSelect">
                    <option value="">Select Tone</option>
                    <option value="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">Standard Alert</option>
                    <option value="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg">MindChime</option>
                    <option value="https://actions.google.com/sounds/v1/foley/door_bell.ogg">Soft Bell</option>
                    <option value="https://actions.google.com/sounds/v1/water/waves_crashing_on_rocks.ogg">Zen Waves (New)</option>
                    <option value="https://actions.google.com/sounds/v1/emergency/emergency_siren_short.ogg">Reality Alert (New)</option>
                </select>
            </div>
        </div>

        <div class="settings-card">
            <h5><i class="fas fa-key me-2"></i> Account</h5>
            <div class="setting-item">
                <label class="fw-bold">Change Password</label>
                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#passwordModal">Update</button>
            </div>
            <div class="setting-item">
                <label class="fw-bold text-danger">Session</label>
                <button class="btn btn-sm btn-danger" id="logoutBtn">Logout & Reset Timer</button>
            
            </div>
        </div>
    </div>

    <div class="modal fade" id="passwordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow">
                <div class="modal-header">
                    <h5 class="modal-title">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="password" class="form-control mb-3" placeholder="Current Password">
                    <input type="password" class="form-control mb-3" placeholder="New Password">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-100" id="savePasswordBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // --- 1. GLOBAL SCREEN TIME LOGIC ---
        function updateDisplay() {
            let totalSeconds = parseInt(localStorage.getItem('totalScreenTime')) || 0;
            let h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            let m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            let s = (totalSeconds % 60).toString().padStart(2, '0');
            const display = document.getElementById('screenTimeDisplay');
            if(display) display.innerText = `${h}:${m}:${s}`;
        }

        setInterval(() => {
            let isTracking = localStorage.getItem('screenTimeEnabled') !== 'false';
            if (isTracking) {
                let totalSeconds = parseInt(localStorage.getItem('totalScreenTime')) || 0;
                totalSeconds++;
                localStorage.setItem('totalScreenTime', totalSeconds);
                updateDisplay();
            }
        }, 1000);

        const timeSwitch = document.getElementById('screenTimeSwitch');
        timeSwitch.checked = localStorage.getItem('screenTimeEnabled') !== 'false';
        timeSwitch.addEventListener('change', (e) => {
            localStorage.setItem('screenTimeEnabled', e.target.checked);
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            if(confirm("Are you sure? This will reset your screen time session.")){
                localStorage.removeItem('totalScreenTime');
                window.location.href = "login.html";
            }
        });

        // --- 2. CAMERA TO PROFILE PHOTO LOGIC ---
    const openCameraBtn = document.getElementById('openCameraBtn');
    const profileImage = document.getElementById('profileImage');

    openCameraBtn.addEventListener('click', async () => {
        try {
            // कॅमेरा एक्सेस मिळवणे
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            
            // एक तात्पुरता व्हिडिओ एलिमेंट तयार करणे
            const video = document.createElement('video');
            video.srcObject = stream;
            video.play();

            // फोटो कॅप्चर करण्यासाठी छोटा डिले
            setTimeout(() => {
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                // फोटोला प्रोफाइल इमेज म्हणून सेट करणे
                const imageData = canvas.toDataURL('image/png');
                profileImage.src = imageData;
                localStorage.setItem('userProfilePic', imageData); // फोटो सेव्ह करणे

                // कॅमेरा बंद करणे
                stream.getTracks().forEach(track => track.stop());
                alert("Profile Photo Updated from Camera!");
            }, 2000); // २ सेकंदात फोटो क्लिक होईल

        } catch (err) {
            alert("Camera access denied or not available.");
        }
    });

    // पेज लोड झाल्यावर जुना फोटो लोड करणे
    window.onload = () => {
        const savedPic = localStorage.getItem('userProfilePic');
        if(savedPic) profileImage.src = savedPic;
        updateDisplay();
    };

        

        // --- 3. THEME & OTHER UI ---
        const applyTheme = (theme) => {
            document.body.classList.toggle('dark-mode', theme === 'dark');
            localStorage.setItem('theme', theme);
        };
        document.getElementById('theme-light').addEventListener('click', () => applyTheme('light'));
        document.getElementById('theme-dark').addEventListener('click', () => applyTheme('dark'));
        if(localStorage.getItem('theme') === 'dark') applyTheme('dark');

        document.getElementById('accentColor').addEventListener('input', (e) => {
            document.documentElement.style.setProperty('--primary-color', e.target.value);
            localStorage.setItem('accentColor', e.target.value);
        });

        document.getElementById('photoUpload').addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.onload = (event) => document.getElementById('profileImage').src = event.target.result;
            reader.readAsDataURL(e.target.files[0]);
        });

        document.getElementById('savePasswordBtn').addEventListener('click', () => {
            alert('Password updated successfully!');
            bootstrap.Modal.getInstance(document.getElementById('passwordModal')).hide();
        });

        const savedColor = localStorage.getItem('accentColor');
        if(savedColor) {
            document.documentElement.style.setProperty('--primary-color', savedColor);
            document.getElementById('accentColor').value = savedColor;
        }
        
        updateDisplay();

//////////
// --- 1. स्क्रीन टाइम अपडेट लॉजिक ---
function updateDisplay() {
    let totalSeconds = parseInt(localStorage.getItem('totalScreenTime')) || 0;
    let h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
    let m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
    let s = (totalSeconds % 60).toString().padStart(2, '0');
    const display = document.getElementById('screenTimeDisplay');
    if(display) display.innerText = `${h}:${m}:${s}`;
}

// हा इंटरव्हल दर सेकंदाला वेळ मोजतो
setInterval(() => {
    let isTracking = localStorage.getItem('screenTimeEnabled') !== 'false';
    if (isTracking) {
        let totalSeconds = parseInt(localStorage.getItem('totalScreenTime')) || 0;
        totalSeconds++;
        localStorage.setItem('totalScreenTime', totalSeconds);
        updateDisplay();
    }
}, 1000);

// --- 2. रिंगटोन आणि टॅब स्विच लॉजिक ---
const audio = new Audio();

// युजरने टॅब बदलला (दुसऱ्या टॅबवर गेला) की साऊंड वाजणार
document.addEventListener('visibilitychange', () => {
    if (document.hidden) { 
        const selectedTone = localStorage.getItem('selectedTone');
        if (selectedTone) {
            audio.src = selectedTone;
            audio.play().catch(e => console.log("Sound play error"));
        }
    }
});

// सेटिंगमध्ये रिंगटोन निवडल्यावर ती सेव्ह करणे
document.getElementById('notifToneSelect').addEventListener('change', (e) => {
    if(e.target.value !== "") {
        localStorage.setItem('selectedTone', e.target.value);
        audio.src = e.target.value;
        audio.play(); // चेक करण्यासाठी एकदा वाजवून दाखवा
    }
});


        
    </script>
</body>
</html>